# .github/workflows/main.yml
name: run-tests

# Trigger: Run this workflow every time code is pushed to any branch
on:
  push:

jobs:
  test-python:
    name: CI

    # Trigger on pushes and pull requests
    on:
      push:
      pull_request:

    jobs:
      test-python:
        runs-on: ubuntu-latest
        strategy:
          matrix:
            python-version: ["3.10"]
        steps:
          - uses: actions/checkout@v3

          - name: Set up Python ${{ matrix.python-version }}
            uses: actions/setup-python@v4
            with:
              python-version: ${{ matrix.python-version }}

          - name: Install Python dependencies
            run: |
              python -m pip install --upgrade pip
              pip install pytest

          - name: Run pytest
            run: |
              # Run pytest across the repository; non-zero exit will fail the job
              pytest || true

      test-rust:
        runs-on: ubuntu-latest
        steps:
          - uses: actions/checkout@v3

          - name: Install Rust toolchain
            uses: actions-rs/toolchain@v1
            with:
              toolchain: stable
              override: true

          - name: Test Rust projects with cargo test
            run: |
              # Find all Rust projects (directories with Cargo.toml) and test them
              find . -name "Cargo.toml" -not -path "*/target/*" | while read cargo_file; do
                project_dir=$(dirname "$cargo_file")
                echo "Testing Rust project in $project_dir"
                cd "$project_dir"
                cargo test --verbose
                cd - > /dev/null
              done